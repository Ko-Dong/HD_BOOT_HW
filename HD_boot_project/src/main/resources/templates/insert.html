<!-- 작성자 : 고동현 -->
<!-- 게시판 글 작성 페이지 작성 -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block th:replace="~{common/layout::setContent(~{this::content})}">
<th:block th:fragment="content">
<head>
<meta charset="UTF-8">
<title>게시물</title>
</head>
<body>
<!-- 게시물 쓰기 시작 -->
<div class="card m-2">
    <div class="card-header">
        게시물 쓰기
    </div>
    <div class="card-body">
        <div>
<!--         게시글 작성 폼 -->
            <form id="boardInsertForm">
                <div class="input-group">
                    <div class="input-group-prepend"><span class="input-group-text">제목</span></div>
                    <input type="text" name="btitle" class="form-control">
                </div>
               
                <div class="input-group">
                    <div class="input-group-prepend"><span class="input-group-text">내용</span></div>
                    <textarea name="bcontent" class="form-control"></textarea>
                </div>
               
                <div class="input-group">
                    <div class="input-group-prepend"><span class="input-group-text">작성자</span></div>
                    <input type="text" name="mid" class="form-control" value="user" readonly>
                </div>
               
                <div class="input-group">
                    <div class="input-group-prepend"><span class="input-group-text">파일 첨부</span></div>
                    <input type="file" class="form-control" name="battach">
                </div>
                   
                <div class="mt-3">
                    <a href="javascript:createBoard()" class="btn btn-info btn-sm mr-2">글작성</a>
                </div>
            </form>
            <script th:inline="javascript">
                function createBoard() {
                    const btitle = $("#boardInsertForm [name=btitle]").val();
                    const bcontent = $("#boardInsertForm [name=bcontent]").val();
                    const mid = $("#boardInsertForm [name=mid]").val();
                    const writer = $("boardInsertForm [name=mid]").val();
                    const battach = document.querySelector("#boardInsertForm [name=battach]").files[0];
                   
                    //폼에 입력된 정보 담아줌
                    const formData = new FormData();
                    formData.append("btitle", btitle);
                    formData.append("bcontent", bcontent);
                    formData.append("mid", mid);
                    formData.append("writer", mid);
                    if(battach) {
                        formData.append("battach", battach);
                    }//end if
                   
                    $.ajax({
                        url: "[(@{/board/create2})]", // 글 작성 호출
                        headers: {Authorization:`Bearer ${sessionStorage.getItem("jwt")}`},
                        method: "post",
                        data: formData,
                        processData: false,
                        contentType: false,
                        cache: false
                    }).done((data) => {
                        console.log(data);
                        location.href="/board/list"; // 글 작성 후 게시글 리스트 출력
                    });
                }
            </script>
        </div>
    </div>
</div>
<!-- 게시물 쓰기 끝 -->
</body>
</html>
